{"version":3,"sources":["i18n.js","rpc.js","util.js","App.js","index.js"],"names":["resources","en","translation","i18n","use","LanguageDetector","initReactI18next","init","fallbackLng","interpolation","escapeValue","rpcAddr","methods","getAdminToken","method","getAddrs","setAddrs","addAddrs","removeAddrs","getLocalIP","getInfo","rpc","hasOwnProperty","addr","params","target","sources","source","Object","keys","key","undefined","util","defaultParams","rpcCall","a","axios","url","timeout","data","id","jsonrpc","response","error","result","Error","acceptAddrs","adminAddrs","App","props","state","adminTokenStr","adminTokenQRCode","localIP","language","showAdvanced","i","languages","length","handleAcceptAddrsChange","bind","handleAdminAddrsChange","handleSubmit","updateAdminToken","handleAdvancedChange","handleLanguageChange","event","this","setState","value","changeLanguage","preventDefault","strToAddrs","addrs","addrsToStr","alert","console","adminToken","JSON","stringify","QRCode","toDataURL","setInterval","then","catch","e","info","ipv4","className","Container","Select","onChange","map","lang","MenuItem","getFixedT","src","alt","t","Trans","i18nKey","components","rel","href","addrToPubKey","Button","variant","color","onClick","style","width","ExpandLess","ExpandMore","Collapse","in","TextField","disabled","multiline","label","join","React","Component","str","split","filter","s","withTranslation","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.2de55432.chunk.js","sourcesContent":["import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nimport translationEN from './translations/en.json';\nimport translationZHCN from './translations/zh-CN.json';\n\nexport const resources = {\n  en: {\n    translation: translationEN\n  },\n  \"zh-CN\": {\n    translation: translationZHCN\n  }\n};\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n    fallbackLng: 'en',\n    interpolation: {\n      escapeValue: false,\n    }\n  });\n\nexport default i18n;\n","import axios from 'axios';\n\nimport * as util from './util';\n\nconst rpcAddr = '/rpc/admin';\n\nconst methods = {\n  getAdminToken: { method: 'getAdminToken' },\n  getAddrs: { method: 'getAddrs' },\n  setAddrs: { method: 'setAddrs' },\n  addAddrs: { method: 'addAddrs' },\n  removeAddrs: { method: 'removeAddrs' },\n  getLocalIP: { method: 'getLocalIP' },\n  getInfo: { method: 'getInfo' },\n}\n\nvar rpc = {};\nfor (let method in methods) {\n  if (methods.hasOwnProperty(method)) {\n    rpc[method] = (addr, params) => {\n      params = util.assignDefined({}, methods[method].defaultParams, params)\n      return rpcCall(addr, methods[method].method, params);\n    }\n  }\n}\n\nasync function rpcCall(addr, method, params = {}) {\n  let response = await axios({\n    url: addr,\n    method: 'POST',\n    timeout: 10000,\n    data: {\n      id: 'nConnect-web',\n      jsonrpc: '2.0',\n      method: method,\n      params: params,\n    },\n  });\n\n  let data = response.data;\n\n  if (data.error) {\n    throw data.error;\n  }\n\n  if (data.result !== undefined) {\n    return data.result;\n  }\n\n  throw new Error('rpc response contains no result or error field');\n}\n\nexport async function getAdminToken() {\n  return rpc.getAdminToken(rpcAddr);\n}\n\nexport async function getAddrs() {\n  return rpc.getAddrs(rpcAddr);\n}\n\nexport async function setAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.setAddrs(rpcAddr, params);\n}\n\nexport async function addAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.addAddrs(rpcAddr, params);\n}\n\nexport async function removeAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.removeAddrs(rpcAddr, params);\n}\n\nexport async function getLocalIP() {\n  return rpc.getLocalIP(rpcAddr);\n}\n\nexport async function getInfo() {\n  return rpc.getInfo(rpcAddr);\n}\n","export function assignDefined(target, ...sources) {\n  for (let source of sources) {\n    if (source) {\n      for (let key of Object.keys(source)) {\n        if (source[key] !== undefined) {\n          target[key] = source[key];\n        }\n      }\n    }\n  }\n  return target;\n}\n","import React from 'react';\nimport QRCode from 'qrcode';\nimport { withTranslation, Trans } from 'react-i18next';\nimport { Button, Collapse, Container, TextField, MenuItem, Select } from '@material-ui/core';\nimport { ExpandLess, ExpandMore } from '@material-ui/icons';\n\nimport i18n, { resources as languages } from './i18n';\nimport * as rpc from './rpc';\n\nimport './App.css';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      adminTokenStr: '',\n      adminTokenQRCode: '',\n      acceptAddrs: '',\n      adminAddrs: '',\n      addr: '',\n      localIP: [],\n      language: '',\n      showAdvanced: false,\n    };\n    for (let i = 0; i < i18n.languages.length; i++) {\n      if (languages[i18n.languages[i]]) {\n        this.state.language = i18n.languages[i];\n        break;\n      }\n    }\n    this.handleAcceptAddrsChange = this.handleAcceptAddrsChange.bind(this);\n    this.handleAdminAddrsChange = this.handleAdminAddrsChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.updateAdminToken = this.updateAdminToken.bind(this);\n    this.handleAdvancedChange = this.handleAdvancedChange.bind(this);\n    this.handleLanguageChange = this.handleLanguageChange.bind(this);\n  }\n\n  handleAcceptAddrsChange(event) {\n    this.setState({ acceptAddrs: event.target.value });\n  }\n\n  handleAdminAddrsChange(event) {\n    this.setState({ adminAddrs: event.target.value });\n  }\n\n  handleAdvancedChange(event) {\n    this.setState({ showAdvanced: !this.state.showAdvanced });\n  }\n\n  handleLanguageChange(event) {\n    this.setState({ language: event.target.value });\n    i18n.changeLanguage(event.target.value);\n  }\n\n  async handleSubmit(event) {\n    event.preventDefault();\n    try {\n      let addrs = await rpc.setAddrs(strToAddrs(this.state.acceptAddrs), strToAddrs(this.state.adminAddrs));\n      this.setState({\n        acceptAddrs: addrsToStr(addrs.acceptAddrs),\n        adminAddrs: addrsToStr(addrs.adminAddrs),\n      });\n      alert('Save success!');\n    } catch (e) {\n      console.error(e);\n      alert(e);\n    }\n  }\n\n  async updateAdminToken() {\n    try {\n      let adminToken = await rpc.getAdminToken();\n      if (adminToken) {\n        let adminTokenStr = JSON.stringify(adminToken);\n        let adminTokenQRCode = await QRCode.toDataURL(adminTokenStr);\n        this.setState({\n          adminTokenStr,\n          adminTokenQRCode,\n        });\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  componentDidMount() {\n    this.updateAdminToken();\n    setInterval(this.updateAdminToken, 5 * 60 * 1000);\n\n    rpc.getAddrs().then((addrs) => {\n      this.setState({\n        acceptAddrs: addrsToStr(addrs.acceptAddrs),\n        adminAddrs: addrsToStr(addrs.adminAddrs),\n      });\n    }).catch((e) => {\n      console.error(e);\n      alert(e);\n    });\n\n    rpc.getInfo().then((info) => {\n      this.setState({\n        addr: info.addr,\n        localIP: info.localIP.ipv4,\n      });\n    }).catch((e) => {\n      console.error(e);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <Container>\n          <div className=\"language-switcher\">\n            <Select\n              value={this.state.language}\n              onChange={this.handleLanguageChange}\n            >\n              {\n                Object.keys(languages).map((lang) => {\n                  return (\n                    <MenuItem key={lang} value={lang}>{i18n.getFixedT(lang)('language')}</MenuItem>\n                  )\n                })\n              }\n            </Select>\n          </div>\n          <div className=\"row\">\n            <img src=\"/static/media/nkn_logo.png\" alt=\"NKN logo\" />\n          </div>\n          <div className=\"row\">\n            <img src={this.state.adminTokenQRCode} alt=\"QR Code\" />\n          </div>\n          <div className=\"row\">\n            {this.props.t('QR code description')}\n          </div>\n          <div className=\"row\">\n            <Trans\n              i18nKey=\"purchase description\"\n              components={{ a: <a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://nconnect-payment.nkncdn.com/payment/?addr=${addrToPubKey(this.state.addr)}&lng=${this.state.language}`} /> }}\n            />\n          </div>\n          <div className=\"row\">\n            <Button\n              variant=\"outlined\"\n              color=\"primary\"\n              onClick={this.handleAdvancedChange}\n              style={{width: '100%'}}\n              >\n              {this.state.showAdvanced ? <ExpandLess /> : <ExpandMore /> }\n              {this.state.showAdvanced ? this.props.t('hide advanced') : this.props.t('show advanced')}\n            </Button>\n          </div>\n          <Collapse in={this.state.showAdvanced}>\n            <div className=\"advanced-row\">\n              <TextField\n                disabled\n                multiline\n                label={this.props.t('local IP address')}\n                value={this.state.localIP.join('\\n')}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <TextField\n                disabled\n                multiline\n                label={this.props.t('access key')}\n                value={this.state.adminTokenStr}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <TextField\n                multiline\n                variant=\"filled\"\n                label={this.props.t('accept addresses')}\n                value={this.state.acceptAddrs}\n                onChange={this.handleAcceptAddrsChange}\n                style={{width: '100%'}}\n                />\n              <TextField\n                multiline\n                variant=\"filled\"\n                label={this.props.t('admins')}\n                value={this.state.adminAddrs}\n                onChange={this.handleAdminAddrsChange}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={this.handleSubmit}\n                style={{width: '100%'}}\n                >\n                {this.props.t('save')}\n              </Button>\n            </div>\n          </Collapse>\n        </Container>\n      </div>\n    );\n  }\n}\n\nfunction addrsToStr(addrs) {\n  if (!addrs) {\n    return '';\n  }\n  return addrs.join('\\n');\n}\n\nfunction strToAddrs(str) {\n  if (!str) {\n    return [];\n  }\n  return str.split('\\n').filter(s => s.length > 0);\n}\n\nfunction addrToPubKey(addr) {\n  let s = addr.split('.');\n  return s[s.length-1];\n}\n\nexport default withTranslation()(App);\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'fontsource-roboto';\nimport './index.css';\nimport './i18n';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}