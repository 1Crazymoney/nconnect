{"version":3,"sources":["rpc.js","util.js","App.js","index.js"],"names":["rpcAddr","methods","getAdminToken","method","getAddrs","setAddrs","addAddrs","removeAddrs","getLocalIP","getInfo","rpc","hasOwnProperty","addr","params","target","sources","source","Object","keys","key","undefined","util","defaultParams","rpcCall","a","axios","url","timeout","data","id","jsonrpc","response","error","result","acceptAddrs","adminAddrs","addrsToStr","addrs","join","strToAddrs","str","split","filter","s","length","addrToPubKey","App","props","state","adminTokenStr","adminTokenQRCode","localIP","showAdvanced","handleAcceptAddrsChange","bind","handleAdminAddrsChange","handleSubmit","updateAdminToken","handleAdvancedChange","event","this","setState","value","console","log","preventDefault","alert","adminToken","JSON","stringify","QRCode","toDataURL","setInterval","then","catch","e","info","ipv4","className","Container","src","href","Button","variant","color","onClick","style","width","ExpandLess","ExpandMore","Collapse","in","TextField","disabled","multiline","label","onChange","React","Component","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.23a6cae1.chunk.js","sourcesContent":["import axios from 'axios';\n\nimport * as util from './util';\n\nconst rpcAddr = '/rpc/admin';\n\nconst methods = {\n  getAdminToken: { method: 'getAdminToken' },\n  getAddrs: { method: 'getAddrs' },\n  setAddrs: { method: 'setAddrs' },\n  addAddrs: { method: 'addAddrs' },\n  removeAddrs: { method: 'removeAddrs' },\n  getLocalIP: { method: 'getLocalIP' },\n  getInfo: { method: 'getInfo' },\n}\n\nvar rpc = {};\nfor (let method in methods) {\n  if (methods.hasOwnProperty(method)) {\n    rpc[method] = (addr, params) => {\n      params = util.assignDefined({}, methods[method].defaultParams, params)\n      return rpcCall(addr, methods[method].method, params);\n    }\n  }\n}\n\nasync function rpcCall(addr, method, params = {}) {\n  let response = await axios({\n    url: addr,\n    method: 'POST',\n    timeout: 10000,\n    data: {\n      id: 'nConnect-web',\n      jsonrpc: '2.0',\n      method: method,\n      params: params,\n    },\n  });\n\n  let data = response.data;\n\n  if (data.error) {\n    throw data.error;\n  }\n\n  if (data.result !== undefined) {\n    return data.result;\n  }\n\n  throw 'rpc response contains no result or error field';\n}\n\nexport async function getAdminToken() {\n  return rpc.getAdminToken(rpcAddr);\n}\n\nexport async function getAddrs() {\n  return rpc.getAddrs(rpcAddr);\n}\n\nexport async function setAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.setAddrs(rpcAddr, params);\n}\n\nexport async function addAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.addAddrs(rpcAddr, params);\n}\n\nexport async function removeAddrs(acceptAddrs, adminAddrs) {\n  let params = {};\n  if (acceptAddrs) {\n    params.acceptAddrs = acceptAddrs;\n  }\n  if (adminAddrs) {\n    params.adminAddrs = adminAddrs;\n  }\n  return rpc.removeAddrs(rpcAddr, params);\n}\n\nexport async function getLocalIP() {\n  return rpc.getLocalIP(rpcAddr);\n}\n\nexport async function getInfo() {\n  return rpc.getInfo(rpcAddr);\n}\n","export function assignDefined(target, ...sources) {\n  for (let source of sources) {\n    if (source) {\n      for (let key of Object.keys(source)) {\n        if (source[key] !== undefined) {\n          target[key] = source[key];\n        }\n      }\n    }\n  }\n  return target;\n}\n","import React from 'react';\nimport QRCode from 'qrcode';\nimport { Button, Collapse, Container, TextField } from '@material-ui/core';\nimport { ExpandLess, ExpandMore } from '@material-ui/icons';\n\nimport * as rpc from './rpc';\n\nimport './App.css';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      adminTokenStr: '',\n      adminTokenQRCode: '',\n      acceptAddrs: '',\n      adminAddrs: '',\n      addr: '',\n      localIP: [],\n      showAdvanced: false,\n    };\n    this.handleAcceptAddrsChange = this.handleAcceptAddrsChange.bind(this);\n    this.handleAdminAddrsChange = this.handleAdminAddrsChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.updateAdminToken = this.updateAdminToken.bind(this);\n    this.handleAdvancedChange = this.handleAdvancedChange.bind(this);\n  }\n\n  handleAcceptAddrsChange(event) {\n    this.setState({ acceptAddrs: event.target.value });\n  }\n\n  handleAdminAddrsChange(event) {\n    this.setState({ adminAddrs: event.target.value });\n  }\n\n  handleAdvancedChange(event) {\n    this.setState({ showAdvanced: !this.state.showAdvanced });\n    console.log(this.state.showAdvanced);\n  }\n\n  async handleSubmit(event) {\n    event.preventDefault();\n    try {\n      let addrs = await rpc.setAddrs(strToAddrs(this.state.acceptAddrs), strToAddrs(this.state.adminAddrs));\n      this.setState({\n        acceptAddrs: addrsToStr(addrs.acceptAddrs),\n        adminAddrs: addrsToStr(addrs.adminAddrs),\n      });\n      alert('Save success!');\n    } catch (e) {\n      console.error(e);\n      alert(e);\n    }\n  }\n\n  async updateAdminToken() {\n    try {\n      let adminToken = await rpc.getAdminToken();\n      if (adminToken) {\n        let adminTokenStr = JSON.stringify(adminToken);\n        let adminTokenQRCode = await QRCode.toDataURL(adminTokenStr);\n        this.setState({\n          adminTokenStr,\n          adminTokenQRCode,\n        });\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  componentDidMount() {\n    this.updateAdminToken();\n    setInterval(this.updateAdminToken, 5 * 60 * 1000);\n\n    rpc.getAddrs().then((addrs) => {\n      this.setState({\n        acceptAddrs: addrsToStr(addrs.acceptAddrs),\n        adminAddrs: addrsToStr(addrs.adminAddrs),\n      });\n    }).catch((e) => {\n      console.error(e);\n      alert(e);\n    });\n\n    rpc.getInfo().then((info) => {\n      this.setState({\n        addr: info.addr,\n        localIP: info.localIP.ipv4,\n      });\n    }).catch((e) => {\n      console.error(e);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <Container>\n          <div className=\"row\">\n            <img src=\"/static/media/nkn_logo.png\" />\n          </div>\n          <div className=\"row\">\n            <img src={this.state.adminTokenQRCode} />\n          </div>\n          <div className=\"row\">\n            Scan the QR code on nMobile Pro to connect and manage device.\n          </div>\n          <div className=\"row\">\n            Purchase data plan on nMobile Pro or <a target=\"_blank\" href={\"http://nconnect-payment.nkncdn.com/payment/?addr=\" + addrToPubKey(this.state.addr)}>web payment portal</a>\n          </div>\n          <div className=\"row\">\n            <Button\n              variant=\"outlined\"\n              color=\"primary\"\n              onClick={this.handleAdvancedChange}\n              style={{width: '100%'}}\n              >\n              {this.state.showAdvanced ? <ExpandLess /> : <ExpandMore /> }\n              {this.state.showAdvanced ? \"Hide Advanced\" : \"Show Advanced\"}\n            </Button>\n          </div>\n          <Collapse in={this.state.showAdvanced}>\n            <div className=\"advanced-row\">\n              <TextField\n                disabled\n                multiline\n                label=\"Local IP address\"\n                value={this.state.localIP.join('\\n')}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <TextField\n                disabled\n                multiline\n                label=\"Access key (expires in 5 minutes)\"\n                value={this.state.adminTokenStr}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <TextField\n                multiline\n                variant=\"filled\"\n                label=\"Accept addresses\"\n                value={this.state.acceptAddrs}\n                onChange={this.handleAcceptAddrsChange}\n                style={{width: '100%'}}\n                />\n              <TextField\n                multiline\n                variant=\"filled\"\n                label=\"Admins\"\n                value={this.state.adminAddrs}\n                onChange={this.handleAdminAddrsChange}\n                style={{width: '100%'}}\n                />\n            </div>\n            <div className=\"advanced-row\">\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={this.handleSubmit}\n                style={{width: '100%'}}\n                >\n                Save\n              </Button>\n            </div>\n          </Collapse>\n        </Container>\n      </div>\n    );\n  }\n}\n\nfunction addrsToStr(addrs) {\n  if (!addrs) {\n    return '';\n  }\n  return addrs.join('\\n');\n}\n\nfunction strToAddrs(str) {\n  if (!str) {\n    return [];\n  }\n  return str.split('\\n').filter(s => s.length > 0);\n}\n\nfunction addrToPubKey(addr) {\n  let s = addr.split('.');\n  return s[s.length-1];\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'fontsource-roboto';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}